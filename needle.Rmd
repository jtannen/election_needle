---
output: html_document
---

<style>

table, td, th {
  border: none;
  padding-left: 1em;
  padding-right: 1em;
  min-width: 50%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}

</style>

[![](`r if(dir.exists("images")) paste0(getwd(),"/") else ""`images/icon.png){width=15%}
![](`r if(dir.exists("images")) paste0(getwd(),"/") else ""`images/logo.png){width=50%}](https://sixtysixwards.com)

```{r setup0, include=FALSE, out.width='80%'}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message=FALSE)

USE_SAVED_COVARIANCE <- TRUE
USE_MAPS <- TRUE
USE_LOGS <- TRUE
IS_PRIMARY <- FALSE

setwd("C:/Users/Jonathan Tannen/Dropbox/sixty_six/posts/election_night_needle/")
source("needle.R")

files <- list.files("raw_data")
file <- max(files)
df <- load_data(file)

if(IS_PRIMARY){
  mayor_office <- "MAYOR-DEM" 
  pred_office <- "COUNCIL AT LARGE-DEM"
  turnout_cov <- cov_list$turnout_cov_dem
} else {
  mayor_office <- "MAYOR"
  pred_office <- "COUNCIL AT LARGE"
  turnout_cov <- cov_list$turnout_cov_general
}

turnout_sim <- get_turnout(df, mayor_office, turnout_cov)
```

# Live Election Night Predictions
Updated at `r gsub("^0","", format(lubridate::ymd_hms(Sys.time()), "%I:%M"))`, with `r scales::comma(length(a_rows))` out of `r scales::comma(length(warddiv_order))` precincts reporting.

DISCLOSURE: This is an experimental project to project final results from incomplete returns. Read about [the ways it did well, and the ways it didn't]() in the primary.

### Council At Large
```{r council_at_large, fig.asp = 2.220, out.width="100%"}
council_at_large_plot <- get_needle_for_office(
  use_office="COUNCIL AT LARGE",
  office_name="Council At Large",
  turnout_sim = turnout_sim,
  n_winners=7
)
council_at_large_dem_plot[["needle"]] %>% print()
```

### Council District 10
```{r , fig.asp = 0.5, out.width="100%"}
district_10_plot <- get_needle_for_office(
  use_office="DISTRICT COUNCIL-10TH DISTRICT",
  office_name="Council District 10",
  turnout_sim = turnout_sim,
  n_winners=1,
  consider_divs = divs_to_council$warddiv[divs_to_council$council == "10"]
)
district_10_plot[["needle"]] %>% print()
```

### Mayor
```{r mayor, fig.asp = 0.33, out.width="100%"}
mayor_plot <- get_needle_for_office(
  use_office="MAYOR",
  office_name="Mayor)",
  turnout_sim = turnout_sim,
  n_winners=1
)
mayor_plot[["needle"]] %>% print()
```


# Maps

### Council At Large
```{r council_at_large_map, fig.asp = 3.5, out.width="100%"}
council_at_large_plot[["map"]] %>% print()
```

### Council District 10
```{r district_10_map, fig.asp = 0.5, out.width="100%"}
district_10_plot[["map"]] %>% print()
```

### Mayor
```{r mayor_map, fig.asp = 0.5, out.width="100%"}
mayor_plot[["map"]] %>% print()
```

